server {
listen 80;
# Το domain (FQDN)
server_name {{ public_fqdn }};

# Endpoint για Let's Encrypt / Certbot (HTTP-01 challenge)
location /.well-known/acme-challenge/ {
root /var/www/certbot;
}

# Κύρια εφαρμογή (Frontend)
# Όλα τα requests εκτός από /api/ προωθούνται στο frontend που ακούει στο 8081
location / {
proxy_pass http://127.0.0.1:8081;
# Κρατάμε το αρχικό Host (domain) και περνάμε client πληροφορία προς το upstream
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
}

# API routes (Backend)
# Ό,τι ξεκινά με /api/ προωθείται στο backend (Spring Boot) που ακούει στο 8080
location /api/ {
proxy_pass http://127.0.0.1:8080;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
}
}
